'""'
å¤©æ°”æŸ¥è¯¢å·¥å…· v1.0 - å‘½ä»¤è¡Œç‰ˆæœ¬
ä½œè€…ï¼šå°å–‡å­-521
GitHub: https://github.com/xiaohuya-521/xiaohuya-521-weather-app
'""'

å¯¼å…¥ è¯·æ±‚
å¯¼å…¥ json

å®šä¹‰ è·å–å¤©æ°”(åŸå¸‚):
    '""'
    è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯
    
    å‚æ•°:
        åŸå¸‚ (str): åŸå¸‚åç§°ï¼Œå¦‚"åŒ—äº¬"ã€"ä¸Šæµ·"
    
    è¿”å›:
        dict: åŒ…å«å¤©æ°”ä¿¡æ¯çš„å­—å…¸ï¼Œæˆ–åŒ…å«é”™è¯¯ä¿¡æ¯çš„å­—å…¸
    ã€Œã€
    å°è¯•:
        # ä½¿ç”¨å…è´¹çš„å¤©æ°”API
        url = f"http://wthrcdn.etouch.cn/weather_mini?city={åŸå¸‚}"
        
        # å‘é€ç½‘ç»œè¯·æ±‚ï¼Œè®¾ç½®5ç§’è¶…æ—¶
        response = requests.get(url, timeout=5)
        
        # æ£€æŸ¥è¯·æ±‚æ˜¯å¦æˆåŠŸ
        å¦‚æœ å“åº”ã€‚çŠ¶æ€ç  == 200:
            data = response.json()  # è§£æJSONæ•°æ®
            
            if data["status"] == 1000:  # APIè¿”å›æˆåŠŸ
                weather_data = data["æ•°æ®"]
                
                # æ•´ç†éœ€è¦çš„ä¿¡æ¯
                è¿”å› {
                    "åŸå¸‚": weather_data["åŸå¸‚"],           # åŸå¸‚åç§°
                    "æ¸©åº¦": weather_data["æ¸©åº¦"],   # æ¸©åº¦
                    "å»ºè®®": weather_data["æ„Ÿå†’"],       # ç”Ÿæ´»å»ºè®®
                    "forecast": weather_data["forecast"][0] # ä»Šæ—¥å¤©æ°”é¢„æŠ¥
                }
            else:
                return {"error": "åŸå¸‚ä¸å­˜åœ¨æˆ–æŸ¥è¯¢å¤±è´¥"}
        else:
            return {"error": f"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : {response.status_code}"}
            
    except requests.exceptions.Timeout:
        return {"error": "è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥"}
    except requests.exceptions.ConnectionError:
        return {"error": "ç½‘ç»œè¿æ¥å¤±è´¥"}
    except Exception as e:
        return {"error": f"ç¨‹åºå¼‚å¸¸: {str(e)}"}

def display_weather(result):
    """
    æ¼‚äº®åœ°æ˜¾ç¤ºå¤©æ°”ä¿¡æ¯
    
    å‚æ•°:
        result (dict): get_weatherå‡½æ•°è¿”å›çš„ç»“æœ
    ã€Œã€
    å¦‚æœ "é”™è¯¯" åœ¨ ç»“æœä¸­:
        æ‰“å°(f"âŒ æŸ¥è¯¢å¤±è´¥: {ç»“æœ['é”™è¯¯']}")
        è¿”å› å‡
    
    # ä½¿ç”¨è¡¨æƒ…ç¬¦å·è®©æ˜¾ç¤ºæ›´å‹å¥½
    æ‰“å°("\n" + "=" * 40)
    æ‰“å°(f"ğŸ“ {ç»“æœ['åŸå¸‚']} å¤©æ°”ä¿¡æ¯")
    æ‰“å°("=" * 40)
    æ‰“å°(f"ğŸŒ¡ï¸  å½“å‰æ¸©åº¦: {['temperature']}â„ƒ")
    æ‰“å°(f"â˜ï¸  ä»Šæ—¥å¤©æ°”: {result[' forecast '][' type ']}")
    print(f"ğŸŒ¬ï¸  é£å‘é£åŠ›: {result['forecast']['fengxiang']} {result['forecast']['fengli']}")
    print(f"ğŸ“… æ—¥æœŸ: {result['forecast']['date']}")
    print(f"ğŸ’¡ ç”Ÿæ´»å»ºè®®: {result['advice']}")
    print("=" * 40)
    
    return True

def main():
    """
    ä¸»å‡½æ•°ï¼Œç¨‹åºå…¥å£
    """
    print("=" * 50)
    print("ğŸŒ¤ï¸  å¤©æ°”æŸ¥è¯¢å·¥å…· v1.0")
    print("=" * 50)
    print("åŠŸèƒ½: æŸ¥è¯¢å…¨å›½åŸå¸‚å®æ—¶å¤©æ°”")
    print("æç¤º: è¾“å…¥åŸå¸‚åç§°æŸ¥è¯¢ï¼Œè¾“å…¥'q'é€€å‡ºç¨‹åº")
    print("=" * 50)
    
    query_count = 0  # æŸ¥è¯¢æ¬¡æ•°ç»Ÿè®¡
    
    while True:
        å°è¯•:
            # è·å–ç”¨æˆ·è¾“å…¥
            city = è¾“å…¥("\nğŸ™ï¸  è¯·è¾“å…¥åŸå¸‚åç§° (è¾“å…¥ q é€€å‡º): ").å»é™¤()
            
            # æ£€æŸ¥æ˜¯å¦é€€å‡º
            å¦‚æœ åŸå¸‚ã€‚å°å†™() == 'q':
                æ‰“å°(f"\næ„Ÿè°¢ä½¿ç”¨ï¼æœ¬æ¬¡å…±æŸ¥è¯¢ {query_count} æ¬¡ã€‚")
                ä¸­æ–­
            
            # æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºç©º
            å¦‚æœ ä¸ åŸå¸‚:
                æ‰“å°("âš ï¸  è¯·è¾“å…¥æœ‰æ•ˆçš„åŸå¸‚åç§°")
                ç»§ç»­
            
            # æŸ¥è¯¢å¤©æ°”
            æ‰“å°(f"ğŸ” æ­£åœ¨æŸ¥è¯¢ {åŸå¸‚} çš„å¤©æ°”...")
            result = è·å–å¤©æ°”(åŸå¸‚)
            
            # æ˜¾ç¤ºç»“æœ
            å¦‚æœ æ˜¾ç¤ºå¤©æ°”(ç»“æœ):
                query_count += 1
                
        é™¤äº† KeyboardInterrupt:
            æ‰“å°("\n\nğŸ‘‹ ç¨‹åºè¢«ä¸­æ–­ï¼Œæ„Ÿè°¢ä½¿ç”¨ï¼")
            ä¸­æ–­
        é™¤äº† å¼‚å¸¸ ä¹‹å¤– ä½œä¸º e:
            æ‰“å°(f"âŒ ç¨‹åºå‡ºé”™: {e}")

å®šä¹‰ è¿è¡Œç¤ºä¾‹():
    '""'
    è¿è¡Œç¤ºä¾‹æŸ¥è¯¢ï¼Œç”¨äºæµ‹è¯•
    ã€Œã€
    æ‰“å°("\nè¿è¡Œç¤ºä¾‹æŸ¥è¯¢...")
    
    test_cities = ["åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·", "æ·±åœ³"]
    
    å¯¹äº åŸå¸‚ åœ¨ æµ‹è¯•åŸå¸‚ä¸­:
        æ‰“å°(f"\næŸ¥è¯¢ {åŸå¸‚}:")
        result = è·å–å¤©æ°”(åŸå¸‚)
        æ˜¾ç¤ºå¤©æ°”(ç»“æœ)

å¦‚æœ __name__ == "__main__":
    # å¯ä»¥é€‰æ‹©ç›´æ¥è¿è¡Œä¸»ç¨‹åºï¼Œæˆ–è¿è¡Œç¤ºä¾‹
    ä¸»()
    # æˆ–è€…è¿è¡Œç¤ºä¾‹: run_example()
